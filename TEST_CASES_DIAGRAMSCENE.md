# DiagramScene 功能度测试 - 详细测试用例

## 1. 绘图工具功能测试

### TC-1.1: 矩形绘制
**优先级**: 🔴 高  
**测试类型**: 功能测试 + 动态测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 启动 DiagramScene | 应用正常启动，显示空白画布 | | ☐ |
| 2 | 从工具栏选择"矩形"工具 | 工具被选中（高亮显示） | | ☐ |
| 3 | 在画布上从 (100,100) 拖拽到 (300,200) | 绘制出 200×100 像素的矩形 | | ☐ |
| 4 | 验证矩形边框 | 黑色边框，清晰可见 | | ☐ |
| 5 | 验证矩形填充 | 白色填充或默认颜色 | | ☐ |
| 6 | 再绘制第二个矩形 | 第一个矩形保留，第二个矩形正确显示 | | ☐ |

**测试代码示例 (AutoHotkey)**:
```autohotkey
; 选择矩形工具
WinActivate, ahk_exe diagramscene.exe
Click, 150, 50  ; 点击工具栏上的矩形按钮
Sleep, 100

; 绘制矩形
Click, 100, 100, Down
Sleep, 50
MouseMove, 300, 200
Sleep, 50
Click, Up

; 验证结果
Sleep, 200
; 可通过截图或检查窗口对象验证
FileAppend, STEP 1: Draw Rectangle - PASS`r`n, %logPath%
```

---

### TC-1.2: 圆形绘制
**优先级**: 🔴 高  
**测试类型**: 功能测试 + 动态测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 选择"圆形"工具 | 工具被选中 | | ☐ |
| 2 | 在画布上绘制圆形 (200,200) 到 (350,350) | 绘制 150×150 的正圆 | | ☐ |
| 3 | 验证圆形轮廓 | 清晰的圆形边界 | | ☐ |
| 4 | 验证填充 | 默认填充颜色 | | ☐ |

**测试检查清单**:
- ✓ 圆形能正确显示
- ✓ 宽高相同时显示正圆
- ✓ 与矩形不重叠

---

### TC-1.3: 菱形绘制
**优先级**: 🔴 高  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 选择"菱形"工具 | 工具被选中 | | ☐ |
| 2 | 绘制菱形 | 显示标准 4 点菱形 | | ☐ |
| 3 | 验证对称性 | 菱形应该对称 | | ☐ |

---

### TC-1.4: 箭头绘制
**优先级**: 🔴 高  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 选择"箭头"工具 | 工具被选中 | | ☐ |
| 2 | 从 (100,100) 绘制箭头到 (300,300) | 显示带箭头的直线 | | ☐ |
| 3 | 验证箭头方向 | 箭头指向终点 (300,300) | | ☐ |

---

## 2. 连接管理功能测试

### TC-2.1: 元素连接
**优先级**: 🔴 高  
**测试类型**: 功能测试 + 动态测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 画布上已有 2 个矩形 | 两个独立的矩形 | | ☐ |
| 2 | 找到第一个矩形的连接点 | 连接点可见（通常为小圆点或方块） | | ☐ |
| 3 | 从连接点 1 拖拽到矩形 2 的连接点 | 出现连接线 | | ☐ |
| 4 | 释放鼠标 | 连接关系保留，连接线显示 | | ☐ |
| 5 | 移动矩形 1 | 连接线跟随移动，保持连接 | | ☐ |
| 6 | 删除矩形 1 | 连接线也被删除 | | ☐ |

**验证检查**:
```python
# 伪代码：验证连接关系
def verify_connection(shape1, shape2, connection_line):
    assert connection_line.start_point == shape1.connection_point
    assert connection_line.end_point == shape2.connection_point
    assert connection_line.is_visible == True
```

---

### TC-2.2: 自动对齐
**优先级**: 🟠 中  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 创建 2 个不对齐的矩形 | 矩形显示在不同高度 | | ☐ |
| 2 | 选择 2 个矩形 | 两个矩形均被选中 | | ☐ |
| 3 | 右键菜单选择"对齐" > "垂直中心对齐" | 两个矩形垂直中线对齐 | | ☐ |
| 4 | 验证对齐结果 | Y 坐标中心相同 | | ☐ |

---

### TC-2.3: 智能布线
**优先级**: 🟠 中  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 连接两个相距较远的矩形 | 出现连接线 | | ☐ |
| 2 | 在两个形状之间放置第三个形状 | 连接线自动重新路由，绕过第三个形状 | | ☐ |
| 3 | 移动中间的形状 | 连接线继续绕路，避免与形状相交 | | ☐ |

---

## 3. 编辑功能测试

### TC-3.1: 元素选择
**优先级**: 🔴 高  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 点击一个矩形 | 矩形被选中，显示选择框（虚线） | | ☐ |
| 2 | 验证选择句柄 | 四个角落和四条边中点显示调整手柄 | | ☐ |
| 3 | 点击空白区域 | 矩形取消选择 | | ☐ |
| 4 | 按住 Ctrl，点击多个元素 | 多个元素同时被选中 | | ☐ |

---

### TC-3.2: 元素移动
**优先级**: 🔴 高  
**测试类型**: 功能测试 + 动态测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 选择一个矩形 | 矩形显示选择状态 | | ☐ |
| 2 | 拖拽矩形到新位置 | 矩形实时跟随鼠标移动 | | ☐ |
| 3 | 释放鼠标 | 矩形停留在新位置 | | ☐ |
| 4 | 验证连接线 | 连接线跟随矩形，保持连接 | | ☐ |

**性能要求**:
- ✓ 移动响应时间 < 50ms
- ✓ 实时刷新流畅（>30 FPS）

---

### TC-3.3: 元素删除
**优先级**: 🔴 高  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 选择一个矩形 | 矩形被选中 | | ☐ |
| 2 | 按 Delete 键 | 矩形从画布消失 | | ☐ |
| 3 | 右键菜单选择"删除" | 同样删除矩形 | | ☐ |
| 4 | 删除有连接的形状 | 形状和关联的连接线都被删除 | | ☐ |
| 5 | 按 Ctrl+Z 撤销 | 被删除的元素恢复 | | ☐ |

---

### TC-3.4: 复制粘贴
**优先级**: 🔴 高  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 选择一个矩形 | 矩形被选中 | | ☐ |
| 2 | 按 Ctrl+C 复制 | 矩形被复制到剪贴板 | | ☐ |
| 3 | 按 Ctrl+V 粘贴 | 在原矩形旁边出现复制的矩形 | | ☐ |
| 4 | 验证粘贴位置 | 新矩形相对原矩形有偏移（避免完全重叠） | | ☐ |
| 5 | 粘贴带连接的元素组 | 元素和连接关系都被复制 | | ☐ |

**验证清单**:
```
✓ 复制的元素与原元素属性相同
✓ 粘贴位置可见（不完全重叠）
✓ 连接关系正确复制
✓ 可连续粘贴多次
```

---

### TC-3.5: 撤销/重做
**优先级**: 🟠 中  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 绘制一个矩形 | 矩形显示 | | ☐ |
| 2 | 按 Ctrl+Z 撤销 | 矩形被移除 | | ☐ |
| 3 | 再按 Ctrl+Z | 继续撤销之前的操作 | | ☐ |
| 4 | 按 Ctrl+Y 重做 | 之前撤销的操作恢复 | | ☐ |
| 5 | 操作历史深度 | 支持至少 10 级撤销/重做 | | ☐ |

---

## 4. 属性编辑测试

### TC-4.1: 颜色设置
**优先级**: 🟠 中  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 选择矩形 | 矩形被选中 | | ☐ |
| 2 | 打开属性面板（右键或菜单） | 属性编辑面板显示 | | ☐ |
| 3 | 找到"填充颜色"选项 | 颜色选择器可用 | | ☐ |
| 4 | 选择红色 (RGB: 255,0,0) | 矩形变为红色 | | ☐ |
| 5 | 修改边框颜色为蓝色 | 矩形边框变为蓝色 | | ☐ |

---

### TC-4.2: 大小调整
**优先级**: 🟠 中  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 选择矩形 | 矩形显示调整手柄 | | ☐ |
| 2 | 拖拽右下角手柄 | 矩形宽高同时增加 | | ☐ |
| 3 | 在属性面板输入精确尺寸 (宽: 300, 高: 150) | 矩形改为指定尺寸 | | ☐ |

---

### TC-4.3: 标签编辑
**优先级**: 🟠 中  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 双击矩形或打开属性面板 | 进入文本编辑模式 | | ☐ |
| 2 | 输入文本 "开始流程" | 文本输入到矩形 | | ☐ |
| 3 | 点击外部或按 Escape | 编辑结束，文本保存 | | ☐ |
| 4 | 验证文本位置 | 文本居中显示在矩形内 | | ☐ |

---

### TC-4.4: 形状类型变换
**优先级**: 🔴 高  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 选择矩形 | 矩形被选中 | | ☐ |
| 2 | 右键菜单选择"转换为"→"圆形" | 矩形形状改为圆形，属性保留 | | ☐ |
| 3 | 验证连接 | 连接关系保留 | | ☐ |
| 4 | 验证文本标签 | 标签仍然显示 | | ☐ |

---

## 5. 模板库功能测试

### TC-5.1: 模板加载
**优先级**: 🟠 中  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 点击菜单 "文件" → "新建" | 显示模板选择对话框 | | ☐ |
| 2 | 选择 "流程图模板" | 模板预览显示 | | ☐ |
| 3 | 点击 "加载" | 模板内容加载到画布 | | ☐ |
| 4 | 验证模板元素 | 所有预定义形状和连接显示 | | ☐ |

---

### TC-5.2: 保存为模板
**优先级**: 🟢 低  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 创建一个完整的流程图 | 流程图完成 | | ☐ |
| 2 | 右键菜单选择 "保存为模板" | 模板保存对话框打开 | | ☐ |
| 3 | 输入模板名称 "我的流程" | 名称被输入 | | ☐ |
| 4 | 点击 "保存" | 模板被保存到模板库 | | ☐ |

---

## 6. 导出功能测试

### TC-6.1: 导出为 PNG
**优先级**: 🔴 高  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 创建一个包含多个形状的流程图 | 流程图完成 | | ☐ |
| 2 | 点击菜单 "文件" → "导出为" | 导出类型选择菜单 | | ☐ |
| 3 | 选择 "PNG 图片" | PNG 导出选项打开 | | ☐ |
| 4 | 指定文件名和保存位置 | 保存对话框 | | ☐ |
| 5 | 点击 "保存" | PNG 文件生成 | | ☐ |
| 6 | 用图片查看器打开文件 | 图片显示完整的流程图 | | ☐ |

**验证清单**:
```
✓ PNG 文件大小合理 (< 1MB)
✓ 图片清晰度足够
✓ 所有元素都出现在图片中
✓ 颜色和文本正确显示
```

---

### TC-6.2: 导出为 PDF
**优先级**: 🔴 高  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 选择 "导出为" → "PDF 文档" | PDF 导出选项 | | ☐ |
| 2 | 设置 PDF 选项（纸张大小、方向） | 选项对话框显示 | | ☐ |
| 3 | 选择保存位置和文件名 | 对话框 | | ☐ |
| 4 | 点击 "保存" | PDF 文件生成 | | ☐ |
| 5 | 用 PDF 阅读器打开 | PDF 显示完整流程图 | | ☐ |

---

### TC-6.3: 导出为 SVG
**优先级**: 🔴 高  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 选择 "导出为" → "SVG 矢量图" | SVG 导出 | | ☐ |
| 2 | 点击 "保存" | SVG 文件生成 | | ☐ |
| 3 | 用浏览器打开 SVG | 流程图清晰显示 | | ☐ |
| 4 | 验证可扩展性 | 放大 SVG 仍清晰 | | ☐ |

---

## 7. 导入功能测试 (如果已实现)

### TC-7.1: 导入 Visio 文件
**优先级**: 🟠 中  
**测试类型**: 功能测试

| 序号 | 步骤 | 预期结果 | 实际结果 | 状态 |
|-----|------|--------|--------|------|
| 1 | 准备一个标准 Visio 文件 (.vsdx) | 文件可用 | | ☐ |
| 2 | 点击 "文件" → "打开" | 文件选择对话框 | | ☐ |
| 3 | 选择 Visio 文件 | 文件被选中 | | ☐ |
| 4 | 点击 "打开" | 文件导入，内容显示在画布 | | ☐ |
| 5 | 验证导入元素 | 所有形状和连接正确显示 | | ☐ |

---

## 测试执行记录

### 测试环境
- **操作系统**: Windows 10/11
- **Qt 版本**: Qt 6.9.2
- **应用版本**: [待填写]
- **测试日期**: [待填写]
- **测试人员**: [待填写]

### 测试结果汇总

```
总测试用例数: 40+
通过数: ___
失败数: ___
跳过数: ___
通过率: ___%

优先级分布:
  🔴 高: 24 个用例
  🟠 中: 12 个用例  
  🟢 低: 4 个用例
```

### 发现的问题

| 编号 | 用例 | 问题描述 | 严重程度 | 状态 |
|-----|------|--------|--------|------|
| BUG-001 | TC-3.1 | [待填写] | 🔴 | ☐ 开放 |
| BUG-002 | TC-4.1 | [待填写] | 🟠 | ☐ 开放 |
| | | | | |

---

**文档版本**: 1.0  
**最后更新**: 2024-12-09  
**维护人**: 测试团队
